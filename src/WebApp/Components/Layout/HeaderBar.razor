@using Microsoft.AspNetCore.Components.Endpoints
@using eShop.WebAppComponents.Layout
@inject NavigationManager Nav

<header class="site-header">
    <div class="header-container">
        <div class="header-top">
            <a class="logo-link" href="/">
                <img alt="AdventureWorks" src="images/logo-header.svg" class="site-logo" />
            </a>
            
            <div class="header-search">
                <form method="get" action="/catalog" class="search-form">
                    <div class="search-input-wrapper">
                        <span class="search-icon">🔍</span>
                        <input 
                            type="search" 
                            name="q" 
                            placeholder="Search gear & apparel" 
                            class="search-input"
                            @bind="searchTerm"
                            @bind:event="oninput"
                            aria-label="Search products" />
                        @if (!string.IsNullOrWhiteSpace(searchTerm))
                        {
                            <a href="/catalog" class="search-clear" aria-label="Clear search">
                                ×
                            </a>
                        }
                    </div>
                    <button type="submit" class="search-submit-btn">Search</button>
                </form>
            </div>
            
            <div class="header-actions">
                <a href="/support" class="expert-help-link">
                    <span class="help-icon">💬</span>
                    <span class="help-text">Expert Help</span>
                </a>
                <UserMenu />
                <CartMenu />
            </div>
        </div>
        
        <div class="header-nav">
            <NavMenu />
        </div>
    </div>
</header>

@code {
    private string searchTerm = "";

    protected override void OnInitialized()
    {
        // Get search term from URL if present
        var uri = new Uri(Nav.Uri);
        var query = System.Web.HttpUtility.ParseQueryString(uri.Query);
        searchTerm = query["q"] ?? "";
    }
}
